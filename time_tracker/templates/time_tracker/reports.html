{% extends 'base.html' %} 

{% block content %} 
    <h1>Historical Time Reports</h1>

    <form method="GET" action="{% url 'reports' %}">
        
        {% if is_admin %}
        <label for="user_id">Report for User:</label>
        <select id="user_id" name="user_id">
            {% for user in users %}
                <option value="{{ user.id }}" {% if user.id == target_user.id %}selected{% endif %}>
                    {{ user.username }} 
                    {% if user.first_name %}({{ user.first_name }} {{ user.last_name }}){% endif %}
                </option>
            {% endfor %}
        </select>
        <br><br>
        {% endif %}

        <label for="date_from">Date From:</label>
        <input type="date" id="date_from" name="date_from" value="{{ date_from }}" required>

        <label for="date_to">Date To:</label>
        <input type="date" id="date_to" name="date_to" value="{{ date_to }}" required>
        
        <button type="submit">Generate Report</button>
    </form>

    <hr>

    <h2>Report for {{ target_user.username }} ({{ date_from }} to {{ date_to }})</h2>
    
    {% if raw_entries %}
        <h3>Summary Totals</h3>
        <p>Total Work Time: <strong>{{ total_work_time }} hours</strong></p>
        <p>Total Break Time: <strong>{{ total_break_time }} hours</strong></p>

        <h3>Raw Entries Detail</h3>
        <table border="1" cellpadding="10" cellspacing="0">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for entry in raw_entries %}
                <tr>
                    <td>{{ entry.date_only|date:"Y-m-d" }}</td>
                    <td>{{ entry.timestamp|date:"H:i:s" }}</td>
                    <td>
                        {% if entry.action_type == 'IN' %}Clock In
                        {% elif entry.action_type == 'OUT' %}Clock Out
                        {% elif entry.action_type == 'BREAK_START' %}Start Break
                        {% elif entry.action_type == 'BREAK_END' %}End Break
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No clocking activity found in the selected date range for this user.</p>
    {% endif %}

    <p><a href="{% url 'dashboard' %}">Back to Dashboard</a></p>
{% endblock content %}